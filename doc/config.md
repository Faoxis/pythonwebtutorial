# Работа с конфигами

В прошлый раз было произведено подключение к базе данных. Подключение было осуществленно с помощью `yaml` - файла с конфигурациями.
На этом шаге будет продемонстрирована работа с файлами конфигурации.
<hr>

### Общее положение дел:
* Существует огромное количество форматов для хранения файлов.
* В данном проекте использует `yaml`-файлы. Это один из наиболее популярных форматов.

### Что вообще происходит ?
* В простейшем случае систаксис конфигурации `yaml` сильно схож со словарем в `python`, т.е. объекты храняться по принципу ключ - значение.
* Проверим это.
* Создадим в папке `config` простой `yaml`-файл `text.yaml` со следующим содержимым:
```yaml
'key1': 'value1'
'key2': 'value2'
'key3': 'value3'
```
* В корне проекта создадим файл `testyaml.py` и напишем в нем следующее:
```python
# Импортируем готовую библиотеку для работы с yaml-форматом
import yaml

# Открываем поток на чтение из файла
with open('config/test.yaml') as file:
    # Содержимое файла заносим в переменную file_content
    file_content = file.read()

# Разбираем содержимое файла и заносим в переменную config
config = yaml.load(file_content)

# Выводим на печать результат
print(config)
```
* В результате получается следующая строка:
```
{'key3': 'value3', 'key1': 'value1', 'key2': 'value2'}
```
* Если ввести команду `print(type(config))`, то можно убедится, что `yaml-парсер` вернул словарь.

### Словарь в словаре
* Да, бывает в жизни так, что нужен словарь в словаре. Как это сделать с помощью `yaml` ?
* Для любого значения в словаре должен быть ключ, значит для словаря в словаре тоже нужен ключ.
* Итак, мы хотим создать `yaml`-конфигурацию, которая после парсинга даст нам словарь словарей.
* Сразу к делу. Добавим в `test.yaml` следующее содержимое:
```yaml
'alphakey':
  'betakey1': 'I am just a regulary beta value'
  'betakey2': 'Nothing special' 
```
* Запустим наш уже готовый скрипт `testyaml.py`:
```
{'key1': 'value1', 'key2': 'value2', 'alphakey': {'betakey1': 'I am just a regulary beta value', 'betakey2': 'Nothing special'}, 'key3': 'value3'}
```
* Как видно из нашего эксперимента, получилось как раз то, что мы хотели.
* Можно убедится, что у нас дейтвительно словарь командой `print(type(config['alphakey']))`
* Что еще из этого следует ? Для задания словаря необходимо просто написать значение, потом после двоеточие указать список значений в словаре.


### Возвращаемся к нашим баранам (базе данных)
* В прошлый раз настройка БД была произведена следующим образом:
```python
# Парсинг конфигураций базы данных
with open('config/database.yaml') as file:
    config = yaml.load(file.read())

# Создаем объекта класса DatabaseManager со всеми необходимыми конфигурациями
db = DatabaseManager(config)
```
* Дело в том, что класс `DatabaseManager` в качестве конструктора принимает словарь со значениями настройки
* То есть задание настроек для подключения к базе данных можно было бы сделать и так:
```python
db = DatabaseManager(
    {
        'default': config['default'], # берем значение default из config/database.yaml
        'general': { # Далаем нашее БД alias. Используется только в коде, на реальной БД никак не отображается.
            # Любая БД должна иметь перень настроек для подключения, вот он:
            'driver': config['general']['driver'],
            'database': config['general']['database'],
            'user': config['general']['user'],
            'password': config['general']['password'],
            'host': config['general']['host'],
            'prefix': config['general']['prefix']
        }
    }
)
```
* В качестве эксперемента предлагаю самостоятельно заменить этот код на то, что было и убедится в том, что я не вру (мало ли ?)
* Но для удобства мы в конфиге указали параметры так как они требуются при настройке БД:
```
db = DatabaseManager(config)
```


#### [Назад](../README.md)